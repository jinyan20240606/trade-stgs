# VolatilitySystem 策略优化历史记录

> 数据范围: 2025-02-26 ~ 2026-02-25 (365天) | 市场整体: -47.51%
> **最终策略: [`VolatilitySystemV13_Opt1.py`](user_data/strategies/futures/VolatilitySystemV13_Opt1.py)** ✅ 推荐使用

---

## 策略架构

基于**波动率突破**的合约双向交易策略，核心流程：
```
3H重采样ATR → ADX市场状态分类(强趋势/弱趋势/震荡) → 动态阈值(ATR×乘数) → 入场信号
```

---

## 优化历史概览（34次实验）

| 轮次 | 最佳方案 | 收益率 | 关键改动 | 结论 |
|------|---------|--------|---------|------|
| **V5原始** | — | 28.58% | 基础版本 | 基准 |
| **V5-Opt2** | EMA200出场确认 | 29.48% | 出场加EMA200趋势确认 | ✅ 保留为V6/V7基准 |
| **V6 (A-E)** | 全部无效 | 29.48% | Trailing/BB宽度/持仓衰减 | ❌ custom_stoploss是死代码 |
| **V7-A** | 出场放宽 | 30.47% | ADX>30时不出场 | ✅ 有效 |
| **V7-B** | 动态仓位 | 40.97% | 强趋势70%/震荡30% | ✅ 有效 |
| **V7-E** | A+B组合 | **41.45%** | 出场放宽+动态仓位 | ✅ 里程碑，Calmar 47.28 |
| **V8 (A-E)** | 全部无效 | ≤42.95% | ADX分级/RSI辅助出场/MACD辅助出场/自适应阈值 | ❌ 辅助出场截断趋势 |
| **V9 (1-3)** | 全部无效 | ≤30.63% | 激进仓位/ATR微调/抛物线保护 | ❌ V7-E已是优化极限 |
| **V10 (2,4)** | 全部无效 | ≤40.70% | DI+/DI-出场/不对称止损 | ❌ custom_stoploss启用则退化 |
| **V11-Opt2** | MACD夹角入场 | **41.71%** | 相邻波峰夹角<100°过滤入场 | ✅ 首次有效入场过滤 |
| **V12 (1-3)** | 全部无效 | ≤29.25% | 单峰顶角过滤 | ❌ 高精度低召回困境 |
| **V13-Opt1** | 加仓质量控制 | **41.99%** | 加仓也要求夹角<100° | ✅ 当前最优 |

---

## 最终推荐策略: V13-Opt1

**[`VolatilitySystemV13_Opt1.py`](user_data/strategies/futures/VolatilitySystemV13_Opt1.py)**

### 回测结果

| 指标 | 数值 |
|------|------|
| 收益率 | **41.99%** |
| 交易数 | 143 |
| 胜率 | **53.1%** |
| 最大回撤 | 4.60% |
| Sharpe | 2.00 |
| Sortino | **10.01** |
| Calmar | 47.89 |
| 均笔收益 | 5.32% |
| 市场涨跌 | -49.04%（策略完全逆势） |


#### 回测细分周期测试结果

趋势稳定性测试完成。基于结果分析，规划下一轮优化方向。

关键发现：

牛市（30天）：+6.67%，胜率72.7% ✅ 策略在明确上升趋势中表现优异
震荡（30天）：-0.06%，胜率33.3% ⚠️ 横盘行情是最大弱点
熊市（30天）：-1.43%，胜率41.2% ⚠️ 下跌趋势中短期亏损
混合（365天）：+41.99%，胜率53.1% ✅ 全年基准确认
熊市（90天）：+4.77%，胜率40.0% — 说明长周期熊市也能盈利（靠空单）

### 策略特点（4层叠加）

1. **波动率突破入场**: 3H重采样ATR×动态乘数作为突破阈值，捕捉真实趋势启动
2. **出场放宽（V7-A）**: ADX>30极强趋势时，即使有反向信号也不出场，让大趋势充分运行
3. **动态仓位（V7-B）**: 强趋势70%仓位 / 弱趋势50% / 震荡30%，资金向高质量机会集中
4. **MACD夹角双重过滤（V11+V13）**:
   - **入场过滤**: 相邻MACD波峰/谷连线夹角<100°（动量加速形态）才允许入场，拒绝48个低质量信号
   - **加仓过滤**: 加仓时也要求夹角<100°，避免在动量减弱时加重仓位

### MACD夹角技术原理

```
局部波峰检测: hist[t-1] > 0 且 hist[t-1] > hist[t-2] 且 hist[t-1] > hist[t]
相邻峰连线角度: |arctan2(v2-v1, t2-t1)| × (180/π)
过滤阈值: < 100°（动量加速，趋势持续）
          ≥ 100°（动量减弱或横盘，拒绝入场/加仓）
```

### 核心经验教训

| 结论 | 证据 |
|------|------|
| ✅ 出场放宽有效 | V7-A/E |
| ✅ 动态仓位有效 | V7-B/E |
| ✅ MACD夹角入场过滤有效（唯一有效入场过滤） | V11-Opt2 |
| ✅ 加仓质量控制有效 | V13-Opt1 |
| ❌ 辅助出场信号全部有害（8次验证） | V6-A, V7-D, V8-B/C, V10-Opt4, V11-Opt1 等 |
| ❌ 强选择性入场过滤有害（高精度低召回） | V5-Opt4/5, V6-B, V8-D, V12, V13-Opt2 |
| ❌ MACD夹角黄金阈值100°，放宽/收紧均退化 | V11-Opt3/4, V13-Opt3 |

---

*数据源: Gate.io Futures, 10币种 (BTC/ETH/SOL/ADA/XRP/DOGE/DOT/AVAX/LTC/LINK)*
*回测周期: 2025-02-26 ~ 2026-02-25 (365天)*